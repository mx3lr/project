import bcrypt
import tkinter as tk
from tkinter import messagebox
from regfile import check2



def logins(username, password):  #checks if the students and teachers usernmae is correct
    if users_check(username, password) is True and teachers_check(username, password) is False:
        return MainMenu
    elif users_check(username, password) is False and teachers_check(username, password) is True:
        return TeachersComment
    else:
        return False


def forgot(email, np, confirm_pass):  #storing the users new password, using a hash check
    if check2(np, confirm_pass) is True: 
        store = bcrypt.hashpw(np.encode("utf8"), bcrypt.gensalt())
        if (users_email(email) is not False and teachers_email(email) is False):
            update = ("UPDATE users SET password=? WHERE email=?")
            cursor.execute(update, [(store), (email)])
            db.commit()
            return True 
        elif (users_email(email) is False and teachers_email(email) is not False):
            update1 = ("UPDATE teachers SET password=? WHERE email=?")
            cursor.execute(update1 [(store), (email)])
            db.commit() 
            return True
        else:
            messagebox.showerror("Email", "Email doesn't exist") 
    else:
        pass 


def user_check(username, password):
    # Used for the login function this checks against the username and password the user enters in students table
    find_student = ("SELECT username,password FROM users WHERE username = ?")
    # sql statement for getting the username and password
    cursor.execute(find_student, [(username)])
    check = cursor.fetchone()
    if checking is not None:
        db_user, db_password = checking 
        if (username == db_user) and (bcrypt.checkpw(password.encode("utf8"), db_password) is True):
            return True 
    else:
        return False


def teacher_check(username, password):#checks the username and password entered with the teachers table
    find_teacher = ("SELECT username,password FROM Teachers WHERE username = ?")
    cursor1.execute(find_teacher, [(username)]) #executes the above sql code
    check1 = cursor1.fetchone() 
    if check1 is not None: 
        db_user1, db_password1 = check1 
        if (username == db_user1) and (bcrypt.checkpw(password.encode("utf8"), db_password1) is True):
            return True
    else:
        return False

